/**
 * this is the main application file, which one that init project bind event, etc...
 * Copyright (C) 2013 - Adfab - nicolas labb√© 
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

/** Never call this constant by PG
 * @constant Adfab 
 */
var Adfab = Adfab || {},

	/** Application settings, need to be fill by partner
	 * @constant _plgd_settings 
	 */
    _pg = _pg || {}, 
    
    /** config create from "pl_config" variable
     * @name  PG.Cache.config
     * @constant PG.Cache.config 
     * @type Object
     */
    pl_config = {
        modules: {
            ears: false,
            mouth: false
        },
        scripts: {
            xpath: '//playground.local/js/lib/playground/wgxpath.install.js',
            json: '//playground.local/js/lib/playground/json2.js',
            ears: '//playground.local/js/lib/playground/ears.min.js',
            mouth: '//ic.adfab.fr/mouthnode/leaderboard/others/client-0/script/pg.connect.js'
        },
        debug: true,
        mode: 'dev',
        env: {
        	dev: {
		        url: '//playground.local/flow/XX-XX-YY/rest/',
		        remote: 'playground.local/easyxdm/index',
		        easySwf: 'playground.local/js/lib/easyxdm/easyxdm.swf',
                nameTransport: 'playground.local/easyxdm/name',
		        send: 'playground.local/flow/XX-XX-YY/rest/send',
		        connect: 'playground.local/flow/XX-XX-YY/rest/authent'
        	},
        	prod: {
		        url: 'livedemo.fr/playground/',
		        send: 'send.php',
		        connect: 'connect.php'
        	}
        },
        ns: 'Adfab.playground'
    };
function extend(a,b){var c=Object.prototype.toString,d=c.call({}),e;for(e in b)b[e]&&d==c.call(b[e])?(a[e]=a[e]||{},extend(a[e],b[e])):a[e]=b[e];return a}function addToNamespace(a,b){var c={};c[a]=b;return extend(Adfab,{Playground:c})};cache={window:window,document:document,xmlhttp:window.XMLHttpRequest,protocol:"https:"==document.location.protocol?"https://":"http://",isTouchDevice:!!("ontouchstart"in window)||!!("onmsgesturechange"in window),clickEvent:"ontouchstart"in window||"onmsgesturechange"in window?"touchstart":"click",localstorage:"undefined"==typeof window.localStorage||"undefined"==typeof window.sessionStorage?!1:!0};
try{addToNamespace("Cache",cache)}catch(e$$12){throw Error("Cannot extends 'cache' to 'Adfab.playground.Cache'");};var pgutil={not_null:function(a){return null!==a?"undefined"!==typeof a?""!==a?!0:!1:!1:!1},pointOnBox:function(a,b){var c=!1;a.x>b.x&&a.x<parseInt(b.x+b.width,10)&&a.y>b.y&&a.y<parseInt(b.y+b.height,10)&&(c=!0);return c},getObjectFromXpath:function(a){a=document.evaluate(a,document.documentElement,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var b=[];if(a)for(var c=a.iterateNext();c;)b.push(c),c=a.iterateNext();return b},createShape:function(a){var b=document.createElement("div");b.style.position=
"absolute";b.style.top=a.y+"px";b.style.left=a.x+"px";b.style.width=a.width+"px";b.style.height=a.height+"px";b.style.background="red";document.body.appendChild(b)},getOffset:function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{x:b,y:c}},checkXpath:function(a){return 0<PG.Util.getObjectFromXpath(a).length?!0:!1},getValueFromObject:function(a){var b="";PG.Util.not_null(a)&&"object"===typeof a&&(void 0!==
a.value?b=a.value:void 0!==a.innerHTML&&(b=a.innerHTML));return b.replace(/^\s+/g,"").replace(/\s+$/g,"")},createCookie:function(a,b,c){if(PG.Cache.localstorage)localStorage.setItem(PG.Config.ns+"."+a,b);else{if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires\x3d"+d.toGMTString()}else c="";document.cookie=PG.Config.ns+"."+a+"\x3d"+encodeURIComponent(b)+c+"; path\x3d/"}},GenerateUniqueId:function(){var a=PG.Util.readCookie("unique-id");if(!PG.Util.not_null(a)){var a="abcdefghijklmnopkrstuvwxyz123456789"+
(new Date).getTime(),b="",c;for(c=a.length-1;0<c;c--)b+=a.charAt(Math.floor(Math.random()*(c+1))),b+=a.charAt(c);a=b.slice(0,20);PG.Util.createCookie("unique-id",a)}PG.Util.not_null(PG.User)&&(PG.User.uid=a);return a},readCookie:function(a){if(PG.Cache.localstorage)return localStorage.getItem(PG.Config.ns+"."+a);a=PG.Config.ns+"."+a+"\x3d";for(var b=document.cookie.split(";"),c=0,d="",c=0;c<b.length;c++){for(d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return decodeURIComponent(d.substring(a.length,
d.length))}return null},eraseCookie:function(a){if(PG.Cache.localstorage)return localStorage.removeItem(PG.Config.ns+"."+a);document.cookie=PG.Config.ns+"."+a+"\x3d''; expires\x3dThu, 01 Jan 1970 00:00:01 GMT; path\x3d/"},matchUrl:function(a){try{return a=eval(a),a.test(window.location.href)}catch(b){return!1}},isUrlValid:function(a){return 0<=PG.Config.env[PG.Config.mode].url.indexOf(a)?!1:!0},log:function(a){PG.Config.debug&&(console.log("%c\x3e PLAYGROUND DEBUG ::","color:blue; font-weight:bold;"),
console.log(a))},getDomElemntFromItem:function(a){var b=null;"id"===a.selector?b=document.getElementById(a.name):"class"===a.selector&&(b=document.getElementsByClassName(a.name),null!==b&&0<b.length&&(b=b[0]));return b},fireEvt:function(a,b,c){if(window.dispatchEvent){var d=document.createEvent("Event");d.initEvent(a,!0,!0);d.data=c;b.dispatchEvent(d)}else window.fireEvent&&b.fireEvent(a)},saysWho:function(){var a=navigator.appName,b=navigator.userAgent,c,d=b.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
if(d&&null!=(c=b.match(/version\/([\.\d]+)/i)))d[2]=c[1];return d=d?[d[1],d[2]]:[a,navigator.appVersion,"-?"]},loadJs:function(a,b){var c=document.createElement("script"),d;c.type="text/javascript";c.async=!0;c.src=a;d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);c.addEventListener("load",function(){b&&b()})}};try{addToNamespace("Util",pgutil),addToNamespace("Config",pl_config)}catch(e$$14){throw Error("Cannot extends 'Util' to 'Adfab.playground.Util'");};var PG=Adfab.Playground,init;
(function(){function a(b,c){"undefined"!==typeof b[0]&&PG.Util.not_null(b[0])?PG.Util.loadJs(b[0],function(){b.shift();a(b,c)}):c&&c()}var b=[],c=PG.Util.saysWho();"MSIE"===c[0]&&"9.0"===c[1]&&(b.push(PG.Config.scripts.xpath),b.push(PG.Config.scripts.json));a(b,function(){var c=PG.Util.getObjectFromXpath("//script[@data-pg-api-key]"),e={};e.apiKey=c[0].getAttribute("data-pg-api-key");try{addToNamespace("Settings",e)}catch(f){throw Error("Cannot extends 'app' to 'Adfab.playground.Settings'");}c[0].getAttribute("data-ears")&&
b.push(PG.Config.scripts.ears);c[0].getAttribute("data-mouth")&&b.push(PG.Config.scripts.mouth);a(b,function(){try{addToNamespace("Config",pl_config)}catch(a){throw Error("Cannot extends 'app' to 'Adfab.playground.Config'");}})})})();
